{% extends "dev/base.html" %}
{% load i18n %}

{% block htitle %}SPARCS SSO Test Service{% endblock %}

{% block header %}
{% endblock %}

{% block content %}
<h1>Test Service {% if service %}Edit{% else %}Add{% endif %}</h1>
<form id="service" class="form-horizontal" action="/dev/service/{% if service %}{{service.name}}{% else %}add{% endif %}/" method="post">
    <fieldset>
        {% csrf_token %}
        <div class="form-group">
            <label class="col-sm-2 control-label">Name</label>
            <div class="col-xs-offset-1 col-xs-10 col-sm-offset-0 col-sm-8">
                <input type="text" class="form-control" name="name" readonly value="{% if service %}{{service.name}}{% else %}AUTO GENERATED{% endif %}">
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-2 control-label">Alias</label>
            <div class="col-xs-offset-1 col-xs-10 col-sm-offset-0 col-sm-8">
                <input type="text" class="form-control" name="alias" placeholder="my test app" required="required" maxlength="30" value="{{service.alias}}">
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-2 control-label">Main URL</label>
            <div class="col-xs-offset-1 col-xs-10 col-sm-offset-0 col-sm-8">
                <input type="url" class="form-control" name="main_url" placeholder="https://example.com/" required="required" maxlength="200" value="{{service.main_url}}">
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-2 control-label">Login Callback URL</label>
            <div class="col-xs-offset-1 col-xs-10 col-sm-offset-0 col-sm-8">
                <input type="url" class="form-control" name="login_callback_url" placeholder="https://example.com/account/login/callback/" required="required" maxlength="200" value="{{service.login_callback_url}}">
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-2 control-label">Unregister URL</label>
            <div class="col-xs-offset-1 col-xs-10 col-sm-offset-0 col-sm-8">
                <input type="url" class="form-control" name="unregister_url" placeholder="https://example.com/account/unregister/" required="required" maxlength="200" value="{{service.unregister_url}}">
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-2 control-label">Secret Key</label>
            <div class="col-xs-offset-1 col-xs-10 col-sm-offset-0 col-sm-8">
                <input type="text" class="form-control" readonly name="secret_key" value="{% if service %}{{service.secret_key}}{% else %}AUTO GENERATED{% endif %}">
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-2 control-label">Cooltime</label>
            <div class="col-xs-offset-1 col-xs-10 col-sm-offset-0 col-sm-8">
                <input type="number" class="form-control" name="cooltime" placeholder="0" required="required" max="60" value="{{service.cooltime}}">
            </div>
        </div>
        <div class="form-group">
            <div class="col-xs-12">
                <button type="submit" class="btn btn-warning">{% if service %}Modify{% else %}Add{% endif %}</button>
                {% if service %}<button type="button" class="btn btn-remove btn-danger">REMOVE</button>{% endif %}
                <a class="btn btn-default" href="/dev/main/">Dev Page</a>
            </div>
        </div>
    </fieldset>
</form>


<script type="text/javascript">
$(function() {
    $('#service').validator();
    $('.btn-remove').click(function() {
        var data = {
            csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
        }
        $.ajax({
            url: '/dev/service/{{service.name}}/delete/',
            type: 'POST',
            data: data,
            success: function(result) {
                window.location.replace('/dev/main/');
            },
        });
    });
});
</script>
{% endblock %}

